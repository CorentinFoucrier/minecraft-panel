#!/usr/bin/env php
<?php

/**
 *******
 * This file is called by docker exec commmand
 * The docker command follows the java command and is launched at each stop
 *******
 */

namespace Bin;

if (PHP_SAPI !== "cli") {
    echo "File only in CLI";
    die(1);
}

$basePath = dirname(dirname(__DIR__)) . DIRECTORY_SEPARATOR;
define('BASE_PATH', $basePath, true);

require_once BASE_PATH . 'www/vendor/autoload.php';

class ErrorsCheck extends \Core\Controller\Controller
{
    public function run()
    {
        $this->loadModel('server');
        $serverEntity = $this->server->selectEverything();
        // If server is stopped or in loading mode there is an error
        // otherwise it's been stopped by user
        if (
            $serverEntity->getStatus() === 0 ||
            $serverEntity->getStatus() === 1
        ) {
            $this->server->update($serverEntity->getId(), ['status' => 3]);
        }
    }
}

$app = \App\App::getInstance();
$app::load();

(new ErrorsCheck)->run();
